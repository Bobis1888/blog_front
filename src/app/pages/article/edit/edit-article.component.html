<div *ngIf="content" class="content" [ngClass]="{mobile: isMobile}">

  <div *ngIf="state === 'form'">
    <span *ngIf="content.status === Status.pending" [@opacity-1]
          class="status"> {{ 'editArticlePage.pending' | translate }}</span>
    <span *ngIf="content.status === Status.published" [@opacity-1]
          class="status"> {{ 'editArticlePage.published' | translate }}</span>
  </div>

  <ng-container [ngSwitch]="state">
    <ng-container
      *ngSwitchCase="'form'"
      [ngTemplateOutlet]="form"
    ></ng-container>

    <ng-container
      *ngSwitchCase="'load'"
      [ngTemplateOutlet]="load"
    ></ng-container>

    <ng-container *ngSwitchDefault [ngTemplateOutlet]="form"></ng-container>
  </ng-container>
</div>

<ng-template #form>
  <h1>{{ "editArticlePage.title" | translate }}</h1>
  <div class="editor" *ngIf="editor != undefined" [@opacity-1]>

    <form [formGroup]="formGroup">
      <div class="title">
        <mat-form-field appearance="outline">
          <mat-label>{{ "editArticlePage.articleTitle" | translate }}</mat-label>
          <input
            matInput
            formControlName="title"
            [placeholder]="'editArticlePage.articleTitlePlaceholder' | translate"
          />
          <mat-error
            *ngIf="hasErrors && formGroup.get('title')?.valid == false"
          >
            {{ getErrors("title") }}
          </mat-error>
        </mat-form-field>


      </div>
      <div class="tags">


        <div *ngIf="!content.actions.canEdit">
          <mat-chip-listbox>
            <mat-chip-row *ngFor="let tag of content.tags">
              {{ tag }}
            </mat-chip-row>
          </mat-chip-listbox>
        </div>

        <mat-form-field appearance="outline" *ngIf="content.actions.canEdit">
          <mat-label>{{ 'editArticlePage.tags' | translate }}</mat-label>
          <mat-chip-grid #chipGrid>
            <mat-chip-row *ngFor="let tag of content.tags" (removed)="remove(tag)">
              {{ tag }}
              <button matChipRemove>
                <mat-icon>cancel</mat-icon>
              </button>
            </mat-chip-row>
          </mat-chip-grid>

          <input #tagsInput
                 matInput
                 [placeholder]="'#'"
                 [formControl]="tagCtrl"
                 [matChipInputFor]="chipGrid"
                 [maskito]="maskitoOpt"
                 [matAutocomplete]="auto"
                 [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                 (matChipInputTokenEnd)="add()"
          />
          <mat-icon
            matSuffix
            [matTooltip]="'editArticlePage.tagHint' | translate"
            [matTooltipPosition]="'left'"
          >
            help_outline
          </mat-icon>
          <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event)">
            <mat-option *ngFor="let tag of filteredTags">{{ tag }}</mat-option>
          </mat-autocomplete>
        </mat-form-field>
      </div>
      <div class="menu" *ngIf="content.actions.canEdit">
        <ngx-editor-menu [editor]="editor" [toolbar]="toolbar"></ngx-editor-menu>
      </div>
      <br/>

      <ngx-editor [editor]="editor"
                  [outputFormat]="'html'"
                  formControlName="content"
                  [placeholder]="'editArticlePage.placeholder' | translate">

      </ngx-editor>
    </form>
    <div class="buttons">

      <button
        *ngIf="content.id"
        mat-flat-button
        color="warn"
        (click)="delete()"
      >
        {{ "editArticlePage.delete" | translate }}
      </button>

      <button mat-flat-button type="submit"
              *ngIf="content.actions.canEdit"
              (click)="submit()">
        {{ "editArticlePage.submit" | translate }}
      </button>

      <button
        *ngIf="content.id"
        mat-stroked-button
        routerLink="/article/view/{{ content.id }}"
      >
        {{ "editArticlePage.view" | translate }}
      </button>

      <button
        mat-flat-button
        *ngIf="content.actions.canPublish"
        (click)="changeStatus(Status.published)"
      >
        {{ "editArticlePage.publish" | translate }}
      </button>

      <button
        mat-flat-button
        *ngIf="content.actions.canUnpublish"
        (click)="changeStatus(Status.draft)"
      >
        {{ "editArticlePage.unpublish" | translate }}
      </button>

      <button
        *ngIf="content.actions.canEdit && content.id"
        mat-flat-button
        (click)="editPreview()"
      >
        {{ "editArticlePage.editPreview" | translate }}
      </button>

    </div>
  </div>
</ng-template>

<ng-template #load>
  <br>
  <ngx-skeleton-loader count="2"
                       [theme]="{'width': '75%'}"></ngx-skeleton-loader>
  <br>
  <ngx-skeleton-loader count="14"></ngx-skeleton-loader>
  <br>
  <ngx-skeleton-loader count="1"
                       [theme]="{width : '30%'}"></ngx-skeleton-loader>
  <br>
</ng-template>
