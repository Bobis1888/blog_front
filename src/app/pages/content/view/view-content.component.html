<div *ngIf="content" class="content" [ngClass]="{mobile: isMobile}" id="header" #header >

  <ng-container [ngSwitch]="state">

    <ng-container
      *ngSwitchCase="'loading'"
      [ngTemplateOutlet]="load"
    ></ng-container>

    <ng-container
      *ngSwitchCase="'data'"
      [ngTemplateOutlet]="data"
    ></ng-container>

    <ng-container
      *ngSwitchCase="'empty'"
      [ngTemplateOutlet]="empty"
    ></ng-container>

    <ng-container *ngSwitchDefault [ngTemplateOutlet]="data"></ng-container>
  </ng-container>

  <div class="additional-content" *ngIf="authorContents.length > 0">
    <br>
    <br>
    <h2>{{ 'viewContentPage.fromSameAuthor' | translate }}</h2>
    <mat-divider></mat-divider>
    <br>
    <div class="same-contents" [@opacity-2]>
      <div *ngFor="let cont of authorContents" (click)="nav(cont)">
        {{ cont.title }}
      </div>
    </div>

  </div>

  <div class="additional-content" *ngIf="tagContents.length > 0">
    <br>
    <br>
    <h2>{{ 'viewContentPage.sameTags' | translate }}</h2>
    <mat-divider></mat-divider>
    <br>
    <div class="same-contents" [@opacity-2]>
      <div *ngFor="let cont of tagContents" (click)="nav(cont)">
        {{ cont.title }}
      </div>
    </div>
  </div>

  <div class="to-top" *ngIf="state === 'data' && !isMobile">
    <button mat-fab (click)="scrollToElement(header)">
      <mat-icon>keyboard_arrow_up</mat-icon>
    </button>
  </div>


</div>

<ng-template #data>


  <div class="author">
      <span [routerLink]="'/search'"
            [queryParams]="{q: content.authorName, author: true}">
        {{ content.authorName }}
      </span>

    <button
      *ngIf="content.actions.canSubscribe && authService.isAuthorized"
      mat-flat-button
      (click)="subscribe()"
    >
      {{ 'viewContentPage.subscribe' | translate }}
    </button>
  </div>

  <span *ngIf="content.status === Status.pending"
        class="status"> {{ 'viewContentPage.pending' | translate }}</span>

  <div class="title-container">
    <h1>{{ content.title }}</h1>
  </div>


  <span *ngIf="content.publishedDate"
        class="date">{{ 'viewContentPage.publishedDate' | translate : {date: (content.publishedDate | date : "YYYY.MM.dd")} }}</span>

  <div class="tags">
    <span class="tags-title">{{ 'viewContentPage.tags' | translate }}</span>
    <span>&nbsp;</span>
    <span *ngIf="!content.tags">{{ 'viewContentPage.noTags' | translate }}</span>
    <span class="tag"
          *ngFor="let tag of content.tags"
          [routerLink]="'/search'"
          [queryParams]="{q: tag.replace('#', ''), tag: true}">
      {{ tag }}
    </span>
  </div>

  <br>

  <p class="main-content" [innerHTML]="content.content | safeHtml"></p>
  <br>
  <div class="reactions" *ngIf="content.status != Status.draft">
    <div>
      <mat-icon matBadge="{{ content.countViews }}"
                class="accent-icon"
                matBadgePosition="below after">
        visibility
      </mat-icon>
    </div>
    <div>
      <button mat-icon-button (click)="react(favoriteReaction.value)" [disabled]="!authService.isAuthorized">
        <mat-icon matBadge="{{ favoriteReaction.count }}"
                  class="accent-icon"
                  matBadgePosition="below after">{{ favoriteReaction.value || 'favorite_outline' }}
        </mat-icon>
      </button>

      <button *ngFor="let it of reactions" mat-icon-button
              (click)="react(it.value)"
              [disabled]="!authService.isAuthorized">
        <mat-icon matBadge="{{ it.count }}"
                  class="accent-icon"
                  matBadgePosition="below after">{{ it.value }}
        </mat-icon>
      </button>

      <button mat-icon-button
              [matMenuTriggerFor]="menu"
              *ngIf="authService.isAuthorized">
        <mat-icon>add_circle_outline</mat-icon>
      </button>

      <mat-menu #menu="matMenu" xPosition="before" yPosition="above">
        <div class="reactions-menu">
          <button mat-icon-button
                  *ngFor="let type of ['favorite', 'local_fire_department', 'mood', 'star']"
                  (click)="react(type)"
                  [disabled]="!authService.isAuthorized">
            <mat-icon>{{ type }}</mat-icon>
          </button>
        </div>
      </mat-menu>
    </div>


  </div>
  <br>
  <div class="buttons">
    <button mat-icon-button (click)="share()">
      <mat-icon>share</mat-icon>
    </button>

    <button mat-icon-button (click)="bookmark()" *ngIf="authService.isAuthorized && !content.actions.canDelete">
      <mat-icon>{{ content.isSaved ? 'bookmark' : 'bookmark_border' }}</mat-icon>
    </button>

    <button
      *ngIf="content.actions.canEdit || content.actions.canUnpublish"
      mat-icon-button
      routerLink="/content/edit/{{ content.id }}"
    >
      <mat-icon>edit</mat-icon>
    </button>
  </div>

</ng-template>

<ng-template #empty>
  {{ 'viewContentPage.empty' | translate }}
</ng-template>

<ng-template #load>
  <br>
  <ngx-skeleton-loader count="1" [theme]="{width: '50%'}"></ngx-skeleton-loader>
  <br>
  <ngx-skeleton-loader count="1" [theme]="{width: '75%'}"></ngx-skeleton-loader>
  <br>
  <br>
  <ngx-skeleton-loader [count]="14"></ngx-skeleton-loader>
  <br>
  <ngx-skeleton-loader count="1" [theme]="{width: '25%'}"></ngx-skeleton-loader>
  <br>
</ng-template>
